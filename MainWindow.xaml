<Window x:Class="MDJMediaPlayer.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:vm="clr-namespace:MDJMediaPlayer.ViewModels"
        mc:Ignorable="d"
        Title="MDJ Media Player" Height="640" Width="1100"
        WindowStyle="None" AllowsTransparency="False" Background="{DynamicResource WindowBackgroundBrush}"
        MouseDown="Window_MouseDown"
        MouseMove="Window_MouseMove"
        MouseLeave="Window_MouseLeave">

    <Window.DataContext>
        <vm:MainViewModel />
    </Window.DataContext>

    <Grid Margin="12">
        <Grid.RowDefinitions>
            <RowDefinition x:Name="TopBarRow" Height="38" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <!-- Titlebar -->
        <DockPanel x:Name="TopBar"
                   Grid.Row="0"
                   LastChildFill="True"
                   Margin="4"
                   MouseDown="Titlebar_MouseDown"
                   MouseEnter="TopBar_MouseEnter"
                   MouseLeave="TopBar_MouseLeave">
            <TextBlock Text="MDJ Media Player" Foreground="#FFF" VerticalAlignment="Center" Margin="8,0" FontSize="14" FontWeight="SemiBold" />

            <StackPanel Orientation="Horizontal" DockPanel.Dock="Right" VerticalAlignment="Center" Margin="0,0,8,0">
                <Button x:Name="MinimizeButton" Style="{StaticResource TitlebarButtonStyle}" Click="MinimizeButton_Click">
                    <Path Data="{StaticResource MinimizeIcon}" Stroke="#FFF" StrokeThickness="2" Width="12" Height="12" />
                </Button>
                <Button x:Name="CloseButton" Style="{StaticResource TitlebarButtonStyle}" Click="CloseButton_Click">
                    <Path Data="{StaticResource CloseIcon}" Stroke="#FFF" StrokeThickness="1.5" Width="12" Height="12" />
                </Button>
            </StackPanel>

            <StackPanel Orientation="Horizontal" DockPanel.Dock="Right" VerticalAlignment="Center" Margin="0,0,6,0">
                <Button Command="{Binding AddFilesCommand}" Content="Add Video" Width="100" Margin="8,0" />
                <Button x:Name="FilesListButton" Content="Files List" Width="100" Margin="8,0" Click="FilesListButton_Click" />
                <Button x:Name="FullscreenButton" Content="Fullscreen" Width="100" Margin="8,0" Click="FullscreenButton_Click" />
                <Button x:Name="ExtendedModeButton" Content="Extended Mode" Width="110" Margin="8,0" Click="ExtendedModeButton_Click" />
                <Button x:Name="AboutButton" Content="About" Width="80" Margin="8,0" Click="AboutButton_Click" />
            </StackPanel>

        </DockPanel>

        <!-- Media area with overlay controls -->
        <Border Grid.Row="1" Background="{DynamicResource PanelBackgroundBrush}" CornerRadius="10">
            <Grid MouseMove="MediaArea_MouseMove" Background="Transparent">
                <Grid x:Name="MediaHost">
                    <MediaElement Name="mediaElement" LoadedBehavior="Manual" UnloadedBehavior="Manual" Stretch="Uniform" HorizontalAlignment="Stretch" VerticalAlignment="Stretch" />
                </Grid>

                <!-- "NO VIDEO FOUND" message -->
                <TextBlock Text="NO VIDEO FOUND"
                           HorizontalAlignment="Center"
                           VerticalAlignment="Center"
                           FontSize="24"
                           FontWeight="Bold"
                           Foreground="Gray">
                    <TextBlock.Style>
                        <Style TargetType="TextBlock">
                            <Setter Property="Visibility" Value="Collapsed" />
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding NoVideoFound}" Value="True">
                                    <Setter Property="Visibility" Value="Visible" />
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </TextBlock.Style>
                </TextBlock>

                <TextBlock x:Name="ExtendedModeStatusLabel"
                           Text="EXTENDED MODE"
                           HorizontalAlignment="Center"
                           VerticalAlignment="Center"
                           FontSize="28"
                           FontWeight="Bold"
                           Foreground="#CCFFFFFF"
                           Visibility="Collapsed" />

                <!-- Overlay debug/status (moved next to Next button) -->

                <!-- Floating control panel at bottom center -->
                <Border x:Name="ControlPanel" Style="{StaticResource FloatingControlPanel}" HorizontalAlignment="Center" VerticalAlignment="Bottom" Margin="0,0,0,18" MouseEnter="ControlPanel_MouseEnter" MouseLeave="ControlPanel_MouseLeave">
                    <StackPanel Orientation="Vertical" HorizontalAlignment="Stretch">
                        <TextBlock Text="(NEW VIDEO ADDED)" Foreground="LimeGreen" HorizontalAlignment="Center" Margin="0,0,0,5" FontSize="14" Visibility="Collapsed">
                            <TextBlock.Style>
                                <Style TargetType="TextBlock">
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding IsNewVideoAvailable}" Value="True">
                                            <DataTrigger.EnterActions>
                                                <BeginStoryboard>
                                                    <Storyboard>
                                                        <ObjectAnimationUsingKeyFrames Storyboard.TargetProperty="Visibility">
                                                            <DiscreteObjectKeyFrame KeyTime="0:0:0" Value="{x:Static Visibility.Visible}" />
                                                            <DiscreteObjectKeyFrame KeyTime="0:0:4" Value="{x:Static Visibility.Collapsed}" />
                                                        </ObjectAnimationUsingKeyFrames>
                                                        <DoubleAnimation Storyboard.TargetProperty="Opacity" From="0" To="1" Duration="0:0:1" />
                                                        <DoubleAnimation Storyboard.TargetProperty="Opacity" From="1" To="0" Duration="0:0:1" BeginTime="0:0:3" />
                                                    </Storyboard>
                                                </BeginStoryboard>
                                            </DataTrigger.EnterActions>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </TextBlock.Style>
                        </TextBlock>
                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,0,0,8">
                            <Button Width="44" Height="44" Command="{Binding StopCommand}" Margin="6">
                                <Path Data="{StaticResource StopIcon}" Fill="#FFF" Stretch="Uniform" Width="18" Height="18" />
                            </Button>
                            <Button Width="44" Height="44" Command="{Binding PrevCommand}" Margin="6">
                                <Path Data="{StaticResource PrevIcon}" Fill="#FFF" Stretch="Uniform" Width="18" Height="18" />
                            </Button>
                            <ToggleButton Width="64" Height="64" IsChecked="{Binding IsPlaying}" Margin="6">
                                <ToggleButton.Template>
                                    <ControlTemplate TargetType="ToggleButton">
                                        <Border Background="#232425" CornerRadius="36" Width="64" Height="64">
                                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center" />
                                        </Border>
                                        <ControlTemplate.Triggers>
                                            <Trigger Property="IsChecked" Value="False">
                                                <Setter Property="Content"><Setter.Value>
                                                    <Path Data="{StaticResource PlayIcon}" Fill="#FFF" Stretch="Uniform" Width="22" Height="22" />
                                                </Setter.Value></Setter>
                                            </Trigger>
                                            <Trigger Property="IsChecked" Value="True">
                                                <Setter Property="Content"><Setter.Value>
                                                    <Path Data="{StaticResource PauseIcon}" Fill="#FFF" Stretch="Uniform" Width="22" Height="22" />
                                                </Setter.Value></Setter>
                                            </Trigger>
                                        </ControlTemplate.Triggers>
                                    </ControlTemplate>
                                </ToggleButton.Template>
                            </ToggleButton>
                            <Button x:Name="NextButton" Width="44" Height="44" Command="{Binding NextCommand}" Margin="6">
                                <Path Data="{StaticResource NextIcon}" Fill="#FFF" Stretch="Uniform" Width="18" Height="18" />
                            </Button>
                            <TextBlock x:Name="DebugStatus" Foreground="#FFF" FontSize="12" VerticalAlignment="Center" Margin="8,0,0,0" Text="No track" />
                        </StackPanel>

                        <!-- Seek and volume -->
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>

                            <TextBlock Text="{Binding CurrentTimeText}" Foreground="#DDD" VerticalAlignment="Center" Margin="8" Grid.Column="0" />
                            <Slider x:Name="PositionSlider" Minimum="0" Maximum="{Binding Duration}" Value="{Binding Position, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" Grid.Column="1" VerticalAlignment="Center"
                                    PreviewMouseLeftButtonDown="PositionSlider_PreviewMouseLeftButtonDown" PreviewMouseLeftButtonUp="PositionSlider_PreviewMouseLeftButtonUp" />
                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Grid.Column="2" VerticalAlignment="Center">
                                <TextBlock Text="{Binding TotalTimeText}" Foreground="#DDD" VerticalAlignment="Center" Margin="8,0" />
                                <TextBlock Text="Vol" Foreground="#DDD" VerticalAlignment="Center" Margin="0,0,6,0" />
                                <Slider x:Name="VolumeSlider" Width="110" Minimum="0" Maximum="1" Value="{Binding Volume, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                            </StackPanel>
                        </Grid>
                    </StackPanel>
                </Border>
            </Grid>
        </Border>
    </Grid>
</Window>
